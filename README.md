# encrypt2bdy

使用python将文件加密后上传到百度云


## 配置

1. 申请百度云盘开发者应用

先进行[个人开发者认证](https://pan.baidu.com/union/doc/ml0g2vtvb)（需要实名百度账户和绑定邮箱）然后[创建应用](https://pan.baidu.com/union/doc/fl0hhnulu)

记录下应用的 AppKey 和 Secretkey，分别填入环境变量的 `BDY_APP_KEY` 和 `BDY_SECRET_KEY`

可选：`BDY_APP_NAME` 应用名字，不填默认为 `e2bdy`

2. 映射路径

需要映射一个 `/config` 路径，作为数据库、配置文件、加密密钥的存放路径。

其他路径自由映射为你需要备份的路径。赋予读写权限以避免权限问题的BUG

3. 是否加密

设置环境变量 `ENCRYPT_UPLOAD` 为 1，文件将在加密后被上传。若不需要加密，请设置为0。

应用会在 `/config` 路径生成 `encrypt.key` 文件，该文件用于加密和解密文件的操作。

请注意，加密密钥不要发送、拷贝给任何人！同时也需要做好该密钥的备份操作，否则上传到百度云的加密文件将无法被正常解密！

> 后续将提供独立的解密程序，只要 `encrypt.key` 还存在，云端文件没有损坏，就能成功解密备份到百度云盘的文件。

4. 监控间隔

设置环境变量 `WATCH_INTERVAL` （单位：秒数），建议设置为大于600（即10分钟）的数值。如果您需要同步的文件非常之多，请适当延长此时间，避免出现上个task还没跑完，下一个就要开始了的情况。

程序将在对应间隔后重新检查本地路径的文件列表，并将新文件上传到百度云。

上传文件的判断基于本地数据库中，对应文件的哈希值是否存在。如果一个文件的哈希已经存在，则认为该文件已经上传。

所以，本程序并**不会**检查你是否已经将云端的文件删除，本地文件删除同样不会同步到云端。

5. 路径配置

假设我将我的硬盘映射到了docker容器的 `/hdd` 路径，并需要备份该路径中的 `照片` 文件夹。

照片文件夹内有如下文件

```
test/img1.png
img2.png
```

在yaml内的配置如下

```yaml
local: '/hdd/照片'
remote: '/照片1'
```

最终，程序会将文件上传到百度云盘的如下文件夹

```
apps/应用名称/照片1/test/img1.png
apps/应用名称/照片1/img2.png
```

其中 apps 文件夹在客户端中显示为 `我的应用数据` 百度网盘使用api上传的文件只能上传到此路径。

应用名称为第一点中提到的 `BDY_APP_NAME` 环境变量